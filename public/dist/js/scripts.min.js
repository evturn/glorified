"use strict";var slice=function(){return Function.prototype.call.apply(Array.prototype.slice,arguments)},querySelectorAll=document.querySelectorAll.bind(document),querySelector=document.querySelector.bind(document),getElementById=document.getElementById.bind(document),toggleClass=function(e,t,n){n?e.classList.remove(t):e.classList.add(t)},addEvent=function(e,t,n){function i(e){var t=function(){e()};return t}return null===e||"undefined"==typeof e?!1:void(e.addEventListener?e.addEventListener(t,i(n),!1):e.attachEvent?e.attachEvent("on"+t,i(n)):e["on"+t]=i(n))},Templates=function(){return RB.iconItemTemplate,RB.inputsTemplate,RB.progressBarTemplate,RB.listItemIconTemplate,RB.compileTemplates=function(){RB.iconItemCompiler(),RB.inputsCompiler(),RB.progressBarCompiler(),RB.listItemIconCompiler()},RB.listItemIconCompiler=function(){var e='<i class="animated zoomIn <%= icon %>"></i>';return RB.listItemIconTemplate=_.template(e)},RB.progressBarCompiler=function(){var e='\n      <div class="progress-bar-container" id="list-progress">\n        <div class="not-done" data-notDone="<%= _id %>">\n          <p class="not-done-text"><%= notDoneText %></p>\n        </div>\n        <div class="done" data-done="<%= _id %>">\n          <p class="done-text"><%= doneText %></p>\n        </div>\n      </div>';return RB.progressBarTemplate=_.template(e)},RB.iconItemCompiler=function(){var e='\n        <div class="icon-option" data-icon="fa <%= icon %>">\n          <i class="animated fadeIn fa <%= icon %>"></i>\n          <p class="caption"><%= name %></p>\n        </div>';return RB.iconItemTemplate=_.template(e)},RB.inputsCompiler=function(){var e='\n        <form class="active-form">\n          <div class="input-container">\n            <div class="icon-container">\n              <span class="icon-placeholder"><i class="fa fa-minus-square"></i></span>\n            </div>\n            <input type="text" class="activeInput list-input" name="list" placeholder="List">\n            <div class="validation-container">\n              <span class="kurt-loader">\n                <p class="message"></p>\n              </span>\n              <span class="create-note-btn">\n                <i class="fa fa-check-circle"></i>\n              </span>\n            </div>\n            <div class="icon-dropdown">\n              <div class="icon-arrow"></div>\n              <div class="icon-select"></div>\n            </div>\n          </div>\n          <div class="input-container">\n            <textarea type="text" class="activeInput note-input" name="body" placeholder="New note..."></textarea>\n          </div>\n        </form>\n        <div class="active-progress"></div>';return RB.inputsTemplate=_.template(e)},RB.compileTemplates()};Templates(),RB.User=Backbone.Model.extend({url:"/users",idAttribute:"_id"}),RB.Note=Backbone.Model.extend({idAttribute:"_id"}),RB.List=Backbone.Model.extend({idAttribute:"_id",url:"/lists"}),RB.Lists=Backbone.Collection.extend({model:RB.List,url:"/notes"}),RB.Notes=Backbone.Collection.extend({model:RB.Note,url:"/notes",merge:!0}),_.extend(Backbone.View.prototype,{get:function(){var e=arguments.length<=0||void 0===arguments[0]?{listDestroyed:!1,_id:!1}:arguments[0];app.user.fetch({success:function(t,n){app.listsCollection.stopListening(),app.listsCollection=new RB.Lists(t.attributes.lists),e.listDestroyed?(app.setLists(),app.setProgressBars()):e._id?(app.activeListId=e._id,app.setActiveListId(e._id),app.setLists(),app.setNotes(e._id),app.setProgressBars()):(app.setNotes(app.activeListId),app.resetActiveList(app.activeListId),app.setProgressBars())},error:function(e){console.log(e)}})},post:function(e){$.ajax({url:"/notes/",method:"POST",data:e,success:function(e,t){app.$noteInput.val("").focus(),app.validate(),app.notify(t),app.get({_id:e._id})},error:function(e){console.log(e)}})},put:function(e,t,n){var i=e.get("_id");e.save(t,{url:"/notes/"+i,success:function(e,t){app.notify("Updated"),app.get()},error:function(e){console.log("error ",e)}})},destroy:function(e){var t=e.get("_id");e.set("listId",app.activeListId),null!==t&&e.destroy({url:"/notes/"+t+"?listId="+app.activeListId,success:function(e,t){console.log("success ",e),app.notify("Removed"),app.get()},error:function(e){console.log("error ",e)}})},list:{put:function(e,t){var n=e.get("_id");e.save(t,{url:"/lists/"+n,success:function(e,t){app.notify("Updated"),app.get()},error:function(e){console.log("error ",e)}})},destroy:function(e,t){null!==t&&e.destroy({url:"/lists/"+t,success:function(e,n){console.log("success ",e),app.removeListItemById(t),app.notify("Removed"),app.get({listDestroyed:!0}),app.createList()},error:function(e){console.log("error ",e)}})}},_user:{post:function(e){$.ajax({url:"/users/login",method:"POST",data:e,success:function(e,t){console.log(e),$(".log-message").html('<h3 class="header-text animated fadeInUp">'+e+"</h3>")},error:function(e){console.log(e)}})},put:function(e){var t=app.user.get("_id");app.user.save(e,{url:"/users/facebook/"+t,success:function(e,t){app.notify("Updated"),console.log(e)},error:function(e){console.log("error ",e)}})}}}),_.extend(Backbone.View.prototype,{getActiveListId:function(){var e=app.activeListId;return e},setActiveListId:function(e){return app.$notesContainer.attr("data-list",e),app.activeListId=e,this},getListContainerById:function(e){var t=$(".list-item .inner-container");return t.find("[data-id='"+e+"']")},getListItemIconById:function(e){return $("div").find("[data-list-item-icon='"+e+"']")},removeListItemById:function(e){var t=app.getListContainerById(e);t.parent().remove()},setListValue:function(e){app.$listInput.val(e)},resetActiveList:function(e){var t=$(".list-item"),n=$("div").find("[data-id='"+e+"']");return t.removeClass("active"),n.parent().addClass("active"),n},getListData:function(e){var t=app.notesCollection,n=e,i=t.length,o=t.where({done:!1}).length,s=i-o,a=o/i*100+"%",r=parseInt(a).toFixed(0)+"%",l=s/i*100+"%",c=parseInt(l).toFixed(0)+"%";return{name:name,_id:n,length:i,notDone:o,notDonePct:a,notDoneText:r,done:s,donePct:l,doneText:c}},renderActiveProgressBar:function(e){var t=querySelector(".active-progress"),n=!(0!==t.children.length),i=!(!app.activeListId||app.activeListId!==e._id),o=void 0,s=void 0;n?t.innerHTML=RB.progressBarTemplate(e):!1;for(var a=document.getElementById("list-progress"),r=slice(a.children),l=r,c=Array.isArray(l),p=0,l=c?l:l[Symbol.iterator]();;){var d;if(c){if(p>=l.length)break;d=l[p++]}else{if(p=l.next(),p.done)break;d=p.value}var u=d;u.dataset.done?o=u:s=u}o.children.innerText=e.doneText,o.style.width=e.donePct,s.children.innerText=e.noteDoneText,s.style.width=e.notDonePct,i?app.hasLengthChanged(e):!1},setProgressBars:function(){var e=[],t=0;app.listsCollection.each(function(n){var i=n.id,o=n.attributes.name,s=new RB.Notes(n.attributes.notes),a=s.length,r=s.where({done:!1}).length,l=a-r,c=r/a*100+"%",p=l/a*100+"%",d={name:o,_id:i,length:a,notDone:r,notDonePct:c,done:l,donePct:p};e.push(d),s.stopListening(),t++}),e.forEach(function(e){var t=$("div").find("[data-done='"+e._id+"']"),n=$("div").find("[data-notDone='"+e._id+"']");t.css({width:e.donePct}),n.css({width:e.notDonePct}),app.activeListId&&app.activeListId===e._id&&app.hasLengthChanged(e)})},tojquery:function(e){switch(typeof e){case"object":if(e instanceof jQuery)return e;break;case"string":return $("."===e.charAt(0)?e:document.getElementsByClassName(e))}},convertDate:function(e){var t=new Date(e),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],i=(t.getFullYear(),t.getMonth()),o=(""+(i+1)).slice(-2),s=t.getDate(),a=t.getHours(),r=t.getMinutes(),l=r>10?r:"0"+r,c=a>=12?"pm":"am",p=a>12?a-12:a,d=0===p?12:p,u=o+"/"+s+" "+d+":"+l+c+" "+n[t.getDay()];return u}}),RB.App=Backbone.View.extend({el:".dmc",iconSelectTemplate:_.template($("#icon-select-template").html()),iconPlaceholderTemplate:_.template($("#icon-placeholder-template").html()),iconTemplate:_.template($("#icon-template").html()),events:{"click .create-list-btn":"createList","click .create-note-btn":"createNote","keypress .note-input":"createOnEnter","keyup .activeInput":"validate"},initialize:function(){var e=this;EventHandlers(e)},start:function(){app.renderForms(),app.appendIcons(),app.user=new RB.User,app.listsCollection=null,app.notesCollection=null,app.activeListId=null,app.activeListLength=null,app.mobileClient=null,app.tabletClient=null,app.desktopClient=null,app.windowWidth=$(window).width(),app.windowX=window.innerWidth,app.$lists=$(".lists"),app.$notes=$(".notes"),app.$listInput=$(".list-input"),app.$noteInput=$(".note-input"),app.$notesContainer=$(".notes-container"),app.$listsContainer=$(".lists-container"),app.initializeListeners(),app.user.fetch({success:function(e,t){return null===app.listsCollection&&(app.listsCollection=new RB.Lists(e.attributes.lists),app.setLists(),app.setProgressBars()),app.listsCollection},error:function(e){console.log(e)}})},updateListIcon:function(e){var t=app.activeListId,n=app.getListItemIconById(t),i=app.listsCollection.models,o=i.length,s={icon:e,_id:t,notes:i},a=new RB.List(s);app.list.put(a,s),s.length=o,n.html(RB.listItemIconTemplate(s))},createNote:function(){var e=app.$noteInput.val(),t=app.$listInput.val(),n=!1;if(e.trim()&&""!==t.trim()){var i={body:e,list:t,done:n};if(app.listsCollection.length>0)for(var o=0;o<app.listsCollection.length;o++){var s=app.listsCollection.models[o].body;if(i.body===s)return!1}app.post(i)}},createList:function(){var e=$(".active-progress"),t=$(".input-container .icon-container");app.$noteInput.val(""),app.$listInput.val("").focus(),app.activeListId=null,app.$notesContainer.empty(),t.html(this.iconPlaceholderTemplate()),e.empty(),app.$notesContainer.attr("data-list","")},createOnEnter:function(e){13===e.keyCode&&app.createNote()},validate:function(){var e=app.$noteInput.val(),t=app.$listInput.val(),n=$(".create-note-btn .fa");e.trim()&&""!==t.trim()?n.addClass("ready"):n.removeClass("ready")},setLists:function(){app.$listsContainer.empty(),app.listsCollection.each(function(e){var t=new RB.ListItem({model:e});app.$listsContainer.append(t.render().el)})},setNote:function(e){var t=new RB.NoteItem({model:e});app.$notesContainer.append(t.render().el),autosize(document.querySelectorAll("textarea"))},setNotes:function(e){var t=app.listsCollection.get(e),n=app.sortNotes(t.attributes.notes),i=new RB.Notes(n),o=t.attributes.name,s=$(".input-container .icon-container"),a=t.attributes.icon?{icon:t.attributes.icon}:{icon:"fa fa-tasks"};app.$notesContainer.empty(),app.$listInput.val(o),s.empty(),s.append(app.iconTemplate(a)),i.each(function(e){var t=new RB.NoteItem({model:e});app.$notesContainer.append(t.render().el)}),null===app.activeListLength&&(app.activeListLength=i.length),app.notesCollection=i,app.resetActiveList(o);var r=app.getListData(e);app.renderActiveProgressBar(r)},sortNotes:function(e){var t=_.sortBy(e,"done");return t}}),RB.ListItem=Backbone.View.extend({className:"list-item",listTemplate:_.template($("#list-name-template").html()),events:{"click .inner-container":"selected"},initialize:function(){this.render()},render:function(){return this.$el.html(this.listTemplate(this.model.toJSON())),this},selected:function(e){var t=$(e.currentTarget).data("id"),n=$(".active-progress");n.empty(),app.setNotes(t),app.setActiveListId(t)}}),RB.NoteItem=Backbone.View.extend({className:"note-item",itemTemplate:_.template($("#note-item-template").html()),attributes:{},initalize:function(){this.listenTo(this.model,"destroy",this.remove)},events:{"click .edit .fa-trash":"destroyNote","click .edit .fa-check-square":"toggleDone","click .note-text":"positionCursor","blur .note-text":"updateNoteBody","keyup .note-text":"updateNoteOnEnter"},render:function(){if(!this.model.get("timestamp")&&this.model.get("created")){var e=this.model.get("created");this.model.set("timestamp",this.convertDate(e))}else this.model.get("timestamp")||this.model.get("created")||this.model.set("timestamp",this.convertDate(new Date));return this.model.get("done")||this.model.set("done",!1),this.$el.html(this.itemTemplate(this.model.toJSON())),this.el.dataset.note=this.model.get("_id"),autosize($("textarea")),this},positionCursor:function(e){var t=$(e.currentTarget),n=t.val().length;return app.isMobile?!1:t.hasClass("busy")?!1:(t.addClass("busy"),void t[0].setSelectionRange(n,n+1))},destroyNote:function(){return 1===app.activeListLength?(app.list.destroy(this.model,app.activeListId),!1):(app.destroy(this.model),void this.remove())},toggleDone:function(){var e=this.model.get("done"),t=this.getActiveListId(),n={done:!e,listId:t};app.put(this.model,n,this)},updateNoteBody:function(e){var t=$(e.currentTarget),n=t.val().trim(),i=this.getActiveListId(),o={body:n,listId:i};t.removeClass("busy"),app.put(this.model,o,this)},updateNoteOnEnter:function(e){var t=$(e.currentTarget);13===e.keyCode&&t.blur()}});var EventHandlers=function(e){var t={};return t.initializeListeners=function(){e.fixPath(),e.readClient(),e.setClient(),e.isMobile(),autosize(document.querySelectorAll("textarea")),addEvent(window,"resize",e.setClient),addEvent(querySelector(".nav-avatar"),"click",e.toggleUserDropdown),addEvent(querySelector(".toggle-list-btn"),"click",e.toggleLists),addEvent(querySelector(".active-progress"),"click",e.toggleProgressBarDetails),addEvent(querySelector(".input-container .icon-container"),"click",e.toggleIconsContainer),e.setListActive(),e.onNewIconSelect()},t.toggleLists=function(){var t=(arguments.length<=0||void 0===arguments[0]?{reset:!1}:arguments[0],document.querySelector(".notes")),n=document.querySelector(".lists"),i=n.classList.contains("collapsed"),o=t.classList.contains("collapsed"),s=n.classList.contains("expanded"),a=t.classList.contains("expanded"),r=window.innerWidth;toggleClass(n,"collapsed",i),toggleClass(n,"expanded",s),toggleClass(t,"collapsed",o),toggleClass(t,"expanded",a),600>r?e.animateContainers():e.stopAnimation()},t.notify=function(e){var t=querySelector(".kurt-loader .message");t.innerHTML=e,t.classList.remove("animated","fadeOut"),t.classList.add("animated","fadeIn"),setTimeout(function(){t.classList.remove("animated","fadeIn"),t.classList.add("animated","fadeOut")},1e3)},t.renderForms=function(){var e=document.querySelector(".inputs-container");e.innerHTML=RB.inputsTemplate(),autosize(document.querySelectorAll("textarea"))},t.onNewIconSelect=function(){function t(t){{var n=this.dataset.icon,i=document.querySelector(".icon-dropdown");e.activeListId}i.classList.remove("open"),e.updateListIcon(n)}for(var n=querySelectorAll(".icon-select .icon-option"),i=[].slice.call(n),o=i,s=Array.isArray(o),a=0,o=s?o:o[Symbol.iterator]();;){var r;if(s){if(a>=o.length)break;r=o[a++]}else{if(a=o.next(),a.done)break;r=a.value}var l=r;l.addEventListener("click",t)}},t.appendIcons=function(){for(var e=document.querySelector(".icon-select"),t="",n=RB.icons,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{if(o=n.next(),o.done)break;s=o.value}var a=s;t+=RB.iconItemTemplate(a)}e.innerHTML=t},t.toggleIconsContainer=function(e){var t=document.querySelector(".icon-dropdown"),n=t.classList.contains("open");toggleClass(t,"open",n)},t.setListActive=function(){function e(e){for(var t=n,i=Array.isArray(t),o=0,t=i?t:t[Symbol.iterator]();;){var s;if(i){if(o>=t.length)break;s=t[o++]}else{if(o=t.next(),o.done)break;s=o.value}var a=s;a.classList.remove("active")}this.classList.add("active")}for(var t=querySelectorAll(".list-item"),n=[].slice.call(t),i=n,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var a;if(o){if(s>=i.length)break;a=i[s++]}else{if(s=i.next(),s.done)break;a=s.value}var r=a;r.addEventListener("click",e)}},t.isMobile=function(){var e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(e){var t=document.querySelector("body");t.classList.add("mobile")}return e},t.readClient=function(){var t=window.innerWidth;e.mobileClient=e.isMobile()?!0:!1,800>t&&t>600?(e.tabletClient=!0,e.desktopClient=!1):t>=800&&(e.tabletClient=!1,e.desktopClient=!0)},t.setClient=function(){var t=document.querySelector(".notes"),n=document.querySelector(".lists"),i=window.innerWidth;i>600?(t.classList.remove("expanded","collapsed"),n.classList.remove("expanded","collapsed"),e.stopAnimation()):600>=i&&(t.classList.add("expanded"),n.classList.add("collapsed"),e.animateContainers())},t.animateContainers=function(){var e=document.querySelector(".lists"),t=document.querySelector(".notes"),n=e.classList.contains("collapsed"),i=t.classList.contains("collapsed"),o=e.classList.contains("expanded"),s=t.classList.contains("expanded");n&&s?(e.style.marginLeft="-39%",t.style.marginRight="0%"):o&&i&&(t.style.marginRight="-45%",e.style.marginLeft="0%")},t.stopAnimation=function(){var e=document.querySelector(".lists"),t=document.querySelector(".notes");t.style.marginRight="0%",e.style.marginLeft="0%"},t.toggleProgressBarDetails=function(){var e=document.querySelector(".active-progress"),t=!!e.classList.contains("show-details");toggleClass(e,"show-details",t)},t.toggleUserDropdown=function(){var e=document.querySelector(".user-dd-list"),t=!!e.classList.contains("on");toggleClass(e,"on",t)},t.fixPath=function(){if(window.location.hash&&"#_=_"===window.location.hash){var e={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=e.top,document.body.scrollLeft=e.left}},t.hasLengthChanged=function(t){return e.activeListLength===t.length?!1:(e.activeListLength=t.length,e.animateListTotal(t),!0)},t.animateListTotal=function(e){var t=document.getElementById(e._id),n=t.querySelector(".list-text"),i=n.dataset.length===e._id;i&&(n.classList.remove("fadeInUp"),n.innerHTML=e.length,n.classList.add("fadeOutUp"),setTimeout(function(){n.classList.remove("fadeOutUp"),n.classList.add("fadeInUp")},300))},_.extend(e,t)},app=new RB.App;app.start();