"use strict";var querySelectorAll=document.querySelectorAll.bind(document),querySelector=document.querySelector.bind(document),toggleClass=function(t,e,n){n?t.classList.remove(e):t.classList.add(e)},addEvent=function(t,e,n){function i(t){var e=function(){t()};return e}return null===t||"undefined"==typeof t?!1:void(t.addEventListener?t.addEventListener(e,i(n),!1):t.attachEvent?t.attachEvent("on"+e,i(n)):t["on"+e]=i(n))};RB.User=Backbone.Model.extend({url:"/users",idAttribute:"_id"}),RB.Note=Backbone.Model.extend({idAttribute:"_id"}),RB.List=Backbone.Model.extend({idAttribute:"_id",url:"/lists"}),RB.Lists=Backbone.Collection.extend({model:RB.List,url:"/notes"}),RB.Notes=Backbone.Collection.extend({model:RB.Note,url:"/notes",merge:!0}),_.extend(Backbone.View.prototype,{get:function(){var t=arguments.length<=0||void 0===arguments[0]?{listDestroyed:!1,_id:!1}:arguments[0];app.user.fetch({success:function(e,n){app.listsCollection.stopListening(),app.listsCollection=new RB.Lists(e.attributes.lists),t.listDestroyed?(app.setLists(),app.setProgressBars()):t._id?(app.activeListId=t._id,app.setActiveListId(t._id),app.setLists(),app.setNotes(t._id),app.setProgressBars()):(app.setNotes(app.activeListId),app.resetActiveList(app.activeListId),app.setProgressBars())},error:function(t){console.log(t)}})},post:function(t){$.ajax({url:"/notes/",method:"POST",data:t,success:function(t,e){app.$noteInput.val("").focus(),app.validate(),app.notify(e),app.get({_id:t._id})},error:function(t){console.log(t)}})},put:function(t,e,n){var i=t.get("_id");t.save(e,{url:"/notes/"+i,success:function(t,e){app.notify("Updated"),app.get()},error:function(t){console.log("error ",t)}})},destroy:function(t){var e=t.get("_id");t.set("listId",app.activeListId),null!==e&&t.destroy({url:"/notes/"+e+"?listId="+app.activeListId,success:function(t,e){console.log("success ",t),app.notify("Removed"),app.get()},error:function(t){console.log("error ",t)}})},list:{put:function(t,e){var n=t.get("_id");t.save(e,{url:"/lists/"+n,success:function(t,e){app.notify("Updated"),app.get()},error:function(t){console.log("error ",t)}})},destroy:function(t,e){null!==e&&t.destroy({url:"/lists/"+e,success:function(t,n){console.log("success ",t),app.removeListItemById(e),app.notify("Removed"),app.get({listDestroyed:!0}),app.createList()},error:function(t){console.log("error ",t)}})}},_user:{post:function(t){$.ajax({url:"/users/login",method:"POST",data:t,success:function(t,e){console.log(t),$(".log-message").html('<h3 class="header-text animated fadeInUp">'+t+"</h3>")},error:function(t){console.log(t)}})},put:function(t){var e=app.user.get("_id");app.user.save(t,{url:"/users/facebook/"+e,success:function(t,e){app.notify("Updated"),console.log(t)},error:function(t){console.log("error ",t)}})}}}),_.extend(Backbone.View.prototype,{getActiveListId:function(){var t=app.activeListId;return t},setActiveListId:function(t){return app.$notesContainer.attr("data-list",t),app.activeListId=t,this},getListContainerById:function(t){var e=$(".list-item .inner-container");return e.find("[data-id='"+t+"']")},getListItemIconById:function(t){return $("div").find("[data-list-item-icon='"+t+"']")},removeListItemById:function(t){var e=app.getListContainerById(t);e.parent().remove()},setListValue:function(t){app.$listInput.val(t)},resetActiveList:function(t){var e=$(".list-item"),n=$("div").find("[data-id='"+t+"']");return e.removeClass("active"),n.parent().addClass("active"),n},renderForms:function(){var t=$(".inputs-container");return t.html(this.inputTemplate()),autosize($("textarea")),this},renderActiveProgressBar:function(t){var e=app.notesCollection,n=$(".active-progress"),i=t,o=e.length,s=e.where({done:!1}).length,a=o-s,r=s/o*100+"%",l=parseInt(r).toFixed(0)+"%",c=a/o*100+"%",d=parseInt(c).toFixed(0)+"%",p={name:name,_id:i,length:o,notDone:s,notDonePct:r,notDoneText:l,done:a,donePct:c,doneText:d};0===n.children().length&&n.html(app.progressBarTemplate(p));var u=$("#list-progress").find("[data-done='"+p._id+"']"),m=$("#list-progress").find("[data-notDone='"+p._id+"']"),v=$(".not-done-text"),g=$(".done-text");u.css({width:p.donePct}),m.css({width:p.notDonePct}),g.html(p.doneText),v.html(p.notDoneText),app.activeListId&&app.activeListId===p._id&&app.hasLengthChanged(p)},setProgressBars:function(){var t=[],e=0;app.listsCollection.each(function(n){var i=n.id,o=n.attributes.name,s=new RB.Notes(n.attributes.notes),a=s.length,r=s.where({done:!1}).length,l=a-r,c=r/a*100+"%",d=l/a*100+"%",p={name:o,_id:i,length:a,notDone:r,notDonePct:c,done:l,donePct:d};t.push(p),s.stopListening(),e++}),t.forEach(function(t){var e=$("div").find("[data-done='"+t._id+"']"),n=$("div").find("[data-notDone='"+t._id+"']");e.css({width:t.donePct}),n.css({width:t.notDonePct}),app.activeListId&&app.activeListId===t._id&&app.hasLengthChanged(t)})},tojquery:function(t){switch(typeof t){case"object":if(t instanceof jQuery)return t;break;case"string":return $("."===t.charAt(0)?t:document.getElementsByClassName(t))}},convertDate:function(t){var e=new Date(t),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],i=(e.getFullYear(),e.getMonth()),o=(""+(i+1)).slice(-2),s=e.getDate(),a=e.getHours(),r=e.getMinutes(),l=r>10?r:"0"+r,c=a>=12?"pm":"am",d=a>12?a-12:a,p=0===d?12:d,u=o+"/"+s+" "+p+":"+l+c+" "+n[e.getDay()];return u},appendIcons:function(){var t=document.querySelector(".icon-select"),e="",n=!0,i=!1,o=void 0;try{for(var s,a=RB.icons[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var r=s.value,l=r.icon,c=r.name;e+='<div class="icon-option" data-icon="fa '+l+'">\n                        <i class="animated fadeIn fa '+l+'"></i>\n                        <p class="caption">'+c+"</p>\n                       </div>"}}catch(d){i=!0,o=d}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}t.innerHTML=e}}),RB.App=Backbone.View.extend({el:".dmc",inputTemplate:_.template($("#input-template").html()),progressBarTemplate:_.template($("#progress-bar-template").html()),iconSelectTemplate:_.template($("#icon-select-template").html()),iconPlaceholderTemplate:_.template($("#icon-placeholder-template").html()),iconListItemTemplate:_.template($("#icon-list-item-template").html()),iconTemplate:_.template($("#icon-template").html()),events:{"click .create-list-btn":"createList","click .create-note-btn":"createNote","keyup .note-input":"createOnEnter","keyup .activeInput":"validate"},start:function(){var t=this;EventHandlers(t),t.renderForms(),t.user=new RB.User,t.listsCollection=null,t.notesCollection=null,t.activeListId=null,t.activeListLength=null,t.mobileClient=null,t.tabletClient=null,t.desktopClient=null,t.windowWidth=$(window).width(),t.windowX=window.innerWidth,t.$lists=$(".lists"),t.$notes=$(".notes"),t.$listInput=$(".list-input"),t.$noteInput=$(".note-input"),t.$notesContainer=$(".notes-container"),t.$listsContainer=$(".lists-container"),t.appendIcons(),t.user.fetch({success:function(e,n){return console.log(e),null===t.user&&(t.user=e),null===t.listsCollection&&(t.listsCollection=new RB.Lists(e.attributes.lists),t.setLists(),t.setProgressBars()),t.initializeListeners(),t.listsCollection},error:function(t){console.log(t)}})},updateListIcon:function(t){var e=app.activeListId,n=app.getListItemIconById(e),i=app.listsCollection.models,o=i.length,s={icon:t,_id:e,notes:i},a=new RB.List(s);app.list.put(a,s),s.length=o,n.html(this.iconListItemTemplate(s))},createNote:function(){var t=app.$noteInput.val(),e=app.$listInput.val(),n=!1;if(t.trim()&&""!==e.trim()){var i={body:t,list:e,done:n};if(app.listsCollection.length>0)for(var o=0;o<app.listsCollection.length;o++){var s=app.listsCollection.models[o].body;if(i.body===s)return!1}app.post(i)}},createList:function(){var t=$(".active-progress"),e=$(".input-container .icon-container");app.$noteInput.val(""),app.$listInput.val("").focus(),app.activeListId=null,app.$notesContainer.empty(),e.html(this.iconPlaceholderTemplate()),t.empty(),app.$notesContainer.attr("data-list","")},createOnEnter:function(t){13===t.keyCode&&app.createNote()},validate:function(){var t=app.$noteInput.val(),e=app.$listInput.val(),n=$(".create-note-btn .fa");t.trim()&&""!==e.trim()?n.addClass("ready"):n.removeClass("ready")},setLists:function(){app.$listsContainer.empty(),app.listsCollection.each(function(t){var e=new RB.ListItem({model:t});app.$listsContainer.append(e.render().el)})},setNote:function(t){var e=new RB.NoteItem({model:t});app.$notesContainer.append(e.render().el)},setNotes:function(t){var e=app.listsCollection.get(t),n=app.sortNotes(e.attributes.notes),i=new RB.Notes(n),o=e.attributes.name,s=$(".input-container .icon-container"),a=e.attributes.icon?{icon:e.attributes.icon}:{icon:"fa fa-tasks"};app.$notesContainer.empty(),app.$listInput.val(o),s.empty(),s.append(app.iconTemplate(a)),i.each(function(t){var e=new RB.NoteItem({model:t});app.$notesContainer.append(e.render().el)}),null===app.activeListLength&&(app.activeListLength=i.length),app.notesCollection=i,app.resetActiveList(o),app.renderActiveProgressBar(t)},sortNotes:function(t){var e=_.sortBy(t,"done");return e}}),RB.ListItem=Backbone.View.extend({className:"list-item",listTemplate:_.template($("#list-name-template").html()),events:{"click .inner-container":"selected"},initialize:function(){this.render()},render:function(){return this.$el.html(this.listTemplate(this.model.toJSON())),this},selected:function(t){var e=$(t.currentTarget).data("id"),n=$(".active-progress");n.empty(),app.setNotes(e),app.setActiveListId(e)}}),RB.NoteItem=Backbone.View.extend({className:"note-item",itemTemplate:_.template($("#note-item-template").html()),attributes:{},initalize:function(){this.listenTo(this.model,"destroy",this.remove)},events:{"click .edit .fa-trash":"destroyNote","click .edit .fa-check-square":"toggleDone","click .note-text":"positionCursor","blur .note-text":"updateNoteBody","keyup .note-text":"updateNoteOnEnter"},render:function(){if(!this.model.get("timestamp")&&this.model.get("created")){var t=this.model.get("created");this.model.set("timestamp",this.convertDate(t))}else this.model.get("timestamp")||this.model.get("created")||this.model.set("timestamp",this.convertDate(new Date));return this.model.get("done")||this.model.set("done",!1),this.$el.html(this.itemTemplate(this.model.toJSON())),autosize($("textarea")),$("textarea").css({resize:"none"}),this},positionCursor:function(t){var e=$(t.currentTarget),n=e.val().length;return app.isMobile?!1:e.hasClass("busy")?!1:(e.addClass("busy"),void e[0].setSelectionRange(n,n+1))},destroyNote:function(){return 1===app.activeListLength?(app.list.destroy(this.model,app.activeListId),!1):(app.destroy(this.model),void this.remove())},toggleDone:function(){var t=this.model.get("done"),e=this.getActiveListId(),n={done:!t,listId:e};app.put(this.model,n,this)},updateNoteBody:function(t){var e=$(t.currentTarget),n=e.val().trim(),i=this.getActiveListId(),o={body:n,listId:i};e.removeClass("busy"),app.put(this.model,o,this)},updateNoteOnEnter:function(t){var e=$(t.currentTarget);13===t.keyCode&&e.blur()}});var EventHandlers=function(t){var e={};return e.initializeListeners=function(){t.fixPath(),t.readClient(),t.setClient(),t.isMobile(),autosize(document.querySelectorAll("textarea")),addEvent(window,"resize",t.setClient),addEvent(querySelector(".nav-avatar"),"click",t.toggleUserDropdown),addEvent(querySelector(".toggle-list-btn"),"click",t.toggleLists),addEvent(querySelector(".active-progress"),"click",t.toggleProgressBarDetails),addEvent(querySelector(".input-container .icon-container"),"click",t.toggleIconsContainer),t.setListActive(),t.onNewIconSelect()},e.toggleLists=function(){var e=(arguments.length<=0||void 0===arguments[0]?{reset:!1}:arguments[0],document.querySelector(".notes")),n=document.querySelector(".lists"),i=n.classList.contains("collapsed"),o=e.classList.contains("collapsed"),s=n.classList.contains("expanded"),a=e.classList.contains("expanded"),r=window.innerWidth;toggleClass(n,"collapsed",i),toggleClass(n,"expanded",s),toggleClass(e,"collapsed",o),toggleClass(e,"expanded",a),600>r?t.animateContainers():t.stopAnimation()},e.notify=function(t){var e=querySelector(".kurt-loader .message");e.innerHTML=t,e.classList.remove("animated","fadeOut"),e.classList.add("animated","fadeIn"),setTimeout(function(){e.classList.remove("animated","fadeIn"),e.classList.add("animated","fadeOut")},1e3)},e.onNewIconSelect=function(){function e(e){{var n=this.dataset.icon,i=document.querySelector(".icon-dropdown");t.activeListId}i.classList.remove("open"),t.updateListIcon(n)}var n=querySelectorAll(".icon-select .icon-option"),i=[].slice.call(n),o=!0,s=!1,a=void 0;try{for(var r,l=i[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var c=r.value;c.addEventListener("click",e)}}catch(d){s=!0,a=d}finally{try{!o&&l["return"]&&l["return"]()}finally{if(s)throw a}}},e.toggleIconsContainer=function(t){var e=document.querySelector(".icon-dropdown"),n=e.classList.contains("open");toggleClass(e,"open",n)},e.setListActive=function(){function t(t){var e=!0,i=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(e=(s=a.next()).done);e=!0){var r=s.value;r.classList.remove("active")}}catch(l){i=!0,o=l}finally{try{!e&&a["return"]&&a["return"]()}finally{if(i)throw o}}this.classList.add("active")}var e=querySelectorAll(".list-item"),n=[].slice.call(e),i=!0,o=!1,s=void 0;try{for(var a,r=n[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var l=a.value;l.addEventListener("click",t)}}catch(c){o=!0,s=c}finally{try{!i&&r["return"]&&r["return"]()}finally{if(o)throw s}}},e.isMobile=function(){var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(t){var e=document.querySelector("body");e.classList.add("mobile")}return t},e.readClient=function(){var e=window.innerWidth;t.mobileClient=t.isMobile()?!0:!1,800>e&&e>600?(t.tabletClient=!0,t.desktopClient=!1):e>=800&&(t.tabletClient=!1,t.desktopClient=!0)},e.setClient=function(){var e=document.querySelector(".notes"),n=document.querySelector(".lists"),i=window.innerWidth;i>600?(e.classList.remove("expanded","collapsed"),n.classList.remove("expanded","collapsed"),t.stopAnimation()):600>=i&&(e.classList.add("expanded"),n.classList.add("collapsed"),t.animateContainers())},e.animateContainers=function(){var t=document.querySelector(".lists"),e=document.querySelector(".notes"),n=t.classList.contains("collapsed"),i=e.classList.contains("collapsed"),o=t.classList.contains("expanded"),s=e.classList.contains("expanded");n&&s?(t.style.marginLeft="-39%",e.style.marginRight="0%"):o&&i&&(e.style.marginRight="-45%",t.style.marginLeft="0%")},e.stopAnimation=function(){var t=document.querySelector(".lists"),e=document.querySelector(".notes");e.style.marginRight="0%",t.style.marginLeft="0%"},e.toggleProgressBarDetails=function(){var t=(document.querySelector(".active-progress"),!!bar.classList.contains("show-details"));toggleClass(progressbar,"show-details",t)},e.toggleUserDropdown=function(){var t=document.querySelector(".user-dd-list"),e=!!t.classList.contains("on");toggleClass(t,"on",e)},e.fixPath=function(){if(window.location.hash&&"#_=_"===window.location.hash){var t={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=t.top,document.body.scrollLeft=t.left}},e.hasLengthChanged=function(e){return t.activeListLength===e.length?!1:(t.activeListLength=e.length,t.animateListTotal(e),!0)},e.animateListTotal=function(t){var e=document.getElementById(t._id),n=e.querySelector(".list-text"),i=n.dataset.length===t._id;i&&(n.classList.remove("fadeInUp"),n.innerHTML=t.length,n.classList.add("fadeOutUp"),setTimeout(function(){n.classList.remove("fadeOutUp"),n.classList.add("fadeInUp")},300))},_.extend(t,e)},app=new RB.App;app.start();