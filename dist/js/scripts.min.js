var Note=Backbone.Model.extend({idAttribute:"_id"}),User=Backbone.Model.extend({}),Notes=Backbone.Collection.extend({url:"/notes",model:Note}),ActiveList=Backbone.View.extend({el:".active-list-wrapper",list:null,inputTemplate:_.template($("#active-list-name").html()),initialize:function(e){this.list=e,this.render()},events:{"click .create-note-btn":"createNote","keypress .note-input":"createOnEnter","keyup .active-input":"elluminateBtn"},render:function(){for(var e,t=0;t<this.list.length;t++)e={name:this.list[t].get("list")};$(".form-list-name").html(this.inputTemplate(e))},createOnEnter:function(e){13===e.keyCode&&this.createNote()},elluminateBtn:function(e){var t=$(".note-input").val(),n=$(".list-input").val();t.trim()&&""!==n.trim()?$(".create-note-btn .fa").addClass("ready"):$(".create-note-btn .fa").removeClass("ready")},createNote:function(){var e=$(".note-input").val(),t=$(".list-input").val();if(""===e||""===t)return!1;var n=Date.now(),i=this.convertDate(n);return wrapper.collection.findWhere({body:e})?!1:(wrapper.collection.create({body:e,list:t,created:n,timestamp:i},{success:function(e){var t=new NoteItem({model:e});t.render(),$(".active-notes-container").append(t.el),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">New note created</p>'),$(".note-input").val("")},error:function(e){console.log(e)}}),void notify())},convertDate:function(e){var t=new Date(e),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],i=(t.getFullYear(),t.getMonth()),o=t.getDate(),a=t.getHours(),l=t.getMinutes(),r=a>12?"PM":"AM",s=a>12?a-12:a;i=(""+(i+1)).slice(-2);var c=n[t.getDay()]+" "+i+"/"+o+" "+s+":"+l+r;return c}}),NoteItem=Backbone.View.extend({className:"list-item wow fadeIn animated",itemTemplate:_.template($("#list-active-item").html()),initalize:function(){this.render()},events:{"click .fa-trash":"clear","click .fa-check":"put"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},clear:function(){var e=this,t=this.model;$.ajax({type:"DELETE",url:"notes/"+this.model.get("_id"),data:t.toJSON(),success:function(n){wrapper.collection.remove(t.get("_id")),e.remove(),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">'+n+"</p>"),notify()},error:function(t){e.remove(),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">'+t+"</p>"),notify()}})},put:function(e){var t=$(e.currentTarget),n=this.model;this.model.get("done")?(t.parent().parent().removeClass("done"),n.set({done:!1})):(t.parent().parent().addClass("done"),n.set({done:!0})),$.ajax({type:"PUT",url:"notes/"+n.get("_id"),data:n.toJSON(),dataType:"JSON",success:function(e){console.log(e),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">Note updated</p>'),notify()},error:function(e){console.log(e),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">Note updated</p>'),notify()}}),this.render()}}),MenuItem=Backbone.View.extend({itemTemplate:_.template($("#list-name-item").html()),initalize:function(){this.render()},events:{"click .list-item":"select"},render:function(e){return this.$el.html(this.itemTemplate(e)),this},select:function(e){var t=$(e.currentTarget).data("id");return wrapper.setActive(t),this}}),Wrapper=Backbone.View.extend({el:".dmc",initialize:function(){var e=this;this.collection=new Notes,this.collection.fetch({success:function(t){return console.log("fetch ",t),e.setLists(),e.setActive(),t},error:function(e){$(".active-notes").prepend('<p class="lead">'+e+"</p>")}}),this.listenTo(this.collection,"all",this.setLists)},events:{"click .create-list-btn":"newList"},setLists:function(){$(".lists-container").empty();var e=this,t=[];this.collection.each(function(e){var n=e.get("list");-1===t.indexOf(n)&&t.push(n)});for(var n=0;n<t.length;n++){var i=t[n],o=e.collection.where({list:t[n]}).length,a=new MenuItem;a.render({name:i,length:o}),$(".lists-container").append(a.el)}return this},setActive:function(e){$(".active-notes-container").empty();for(var t=this.collection.where({list:e}),n=(new ActiveList(t),0);n<t.length;n++){var i=new NoteItem({model:t[n]});i.render(),$(".active-notes-container").append(i.el)}return this},newList:function(){$(".active-notes-container").empty(),$(".list-input").val(""),$(".list-input").focus();new ActiveList}});(new WOW).init();var wrapper=new Wrapper;$(document).on("click",".lists-container .list-item",function(){$(".list-item").removeClass("active"),$(this).addClass("active")});var notify=function(){setTimeout(function(){$(".kurt-loader").fadeOut("fast",function(){$(".kurt-loader").empty(),$(".kurt-loader").css({display:"block"})})},3e3)};$(function(){if($('[data-toggle="popover"]').popover({html:!0}),window.location.hash&&"#_=_"===window.location.hash){var e={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=e.top,document.body.scrollLeft=e.left}});