var RB={};RB.Note=Backbone.Model.extend({idAttribute:"_id"}),RB.Notes=Backbone.Collection.extend({model:RB.Note,url:"/notes",merge:!0}),RB.init=function(){RB.fixPath();new RB.App;RB.get(),RB.e.init()},RB.get=function(){var e=new RB.Notes;e.fetch({success:function(e){RB.collection=e;var t=RB.getLists(RB.collection);RB.setLists(t),RB.input=new RB.Input},error:function(e){console.log(e)}})},RB.reset=function(e){var t=RB.collection;t.fetch({success:function(t){var n=RB.getLists(t),o=t.where({list:e});RB.setLists(t,n),RB.setNotes(".active-notes-container",o)},error:function(e){console.log(e)}})},RB.getLists=function(){var e=[];return RB.collection.each(function(t){var n=t.get("list");-1===e.indexOf(n)&&e.push(n)}),e},RB.setLists=function(e){var t=e,n=_.template($("#list-name-template").html()),o=$(".lists-container");o.empty();for(var i=0;i<t.length;i++){var s=RB.collection.where({list:t[i],done:!1}).length;o.append(n({name:t[i],length:s}))}},RB.setNotes=function(e,t){var n=$(".active-notes-container"),o=$(".active-input.list-input"),i=$(".active-input.note-input");if(t.length>0){var s=t[0].get("list");o.val(s),$selector=RB.tojquery(e),$selector.empty();for(var l=0;l<t.length;l++){var a=t[l],c=new RB.NoteItem({model:a});$selector.append(c.render().el)}RB.resetActiveList(s)}else o.val(""),i.val(""),n.empty();RB.e.isMobile()||i.focus()},RB.setNote=function(e){var t=$(".active-notes-container"),n=new RB.NoteItem({model:e});t.append(n.render().el)},RB.notify=function(e){$(".kurt-loader")},RB.fixPath=function(){if(window.location.hash&&"#_=_"===window.location.hash){var e={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=e.top,document.body.scrollLeft=e.left}},RB.tojquery=function(e){switch(typeof e){case"object":if(e instanceof jQuery)return e;break;case"string":return $("."===e.charAt(0)?e:document.getElementsByClassName(e))}},RB.convertDate=function(e){var t=new Date(e),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],o=(t.getFullYear(),t.getMonth()),i=t.getDate(),s=t.getHours(),l=t.getMinutes(),a=l>10?l:"0"+l,c=s>=12?"PM":"AM",r=s>12?s-12:s;o=(""+(o+1)).slice(-2);var u=n[t.getDay()]+" "+o+"/"+i+" "+r+":"+a+c;return u},RB.resetActiveList=function(e){var t=$("div").find("[data-id='"+e+"']");t.addClass("active")},RB.setListValue=function(e){{var t=$(".active-input.list-input");new RB.Input}t.val(e)},RB.post=function(){var e=$(".note-input"),t=$(".list-input").val(),n=Date.now(),o=RB.convertDate(n),i={body:e.val(),list:t,created:n,timestamp:o,done:!1};return RB.collection.findWhere({body:i.body})&&RB.collection.findWhere({list:i.list})?!1:void RB.collection.create(i,{success:function(n){RB.setNote(n),RB.reset(t),e.focus()},error:function(e){console.log(e)}})},RB.put=function(e){var t=(e.get("list"),e.get("_id"));e.save(null,{url:"/notes/"+t,success:function(e){console.log(e.attributes.done),RB.collection.set(e),RB.notify("Updated")}})},RB.destroy=function(e){var t=(e.get("list"),e.get("_id"));null!==t&&e.destroy({wait:!0,url:"/notes/"+t,dataType:"text",data:{_id:t},success:function(e){RB.notify("Note deleted"),console.log("success ",e)},error:function(e){RB.notify("Removed"),console.log("error ",e)}})},RB.e={init:function(){RB.e.setActiveList(),RB.e.deviceEnv(800),RB.e.sunny(),$(document).on("click",".toggle-list-btn",function(){RB.e.toggleLists()}),$(document).on("listSelected",function(){RB.e.garbageWatcher()}),$(document).on("listChanged",function(){RB.e.listWatcher()})},deviceEnv:function(e){RB.e.isMobile()&&setTimeout(RB.e.toggleLists,e)},setActiveList:function(){$(document).on("click",".lists-container .list-item",function(){var e=$(".list-item");e.removeClass("active"),$(this).addClass("active"),$(document).trigger("listSelected")})},toggleLists:function(){var e=$(".lists-container"),t=$(".toggle-list-btn .fa");e.slideToggle("fast"),t.toggleClass("collapsed")},isMobile:function(){var e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return e},garbageWatcher:function(){var e=document.getElementsByClassName("list-item active"),t=$(e).prop("dataset").id,n=RB.collection.where({list:t,done:!0}).length;RB.e.appendDoneStats(n)},appendDoneStats:function(e){var t=$(".garbage-container"),n=($(".garbage-container .stat"),$(".garbage-container .edit"),_.template($("#garbage-watcher-template").html())),o=_.template($("#sunny-template").html());console.log(e),t.html(0!==e?n({length:e}):o())},listWatcher:function(){var e=_.template($("#list-name-template").html()),t=$(".lists-container"),n=document.getElementsByClassName("list-item active"),o=$(n).prop("dataset").id,i=RB.collection.where({list:o,done:!1}).length;$(n).remove(),t.append(e({name:o,length:i}))},sunny:function(){var e=0;setInterval(function(){$(".fa.fa-certificate").css({"-ms-transform":"rotate("+e+"deg)"}).css({"-moz-transform":"rotate("+e+"deg)"}).css({"-o-transform":"rotate("+e+"deg)"}).css({"-webkit-transform":"rotate("+e+"deg)"}).css({transform:"rotate("+e+"deg)"}),e+=3},100)}},RB.App=Backbone.View.extend({el:".dmc",events:{"click .lists-container .list-item":"renderList","click .create-list-btn":"createList"},renderList:function(e){var t=$(e.currentTarget).data("id"),n=RB.collection.where({list:t});RB.setNotes(".active-notes-container",n),RB.e.deviceEnv(400)},createList:function(){var e=$(".note-input"),t=$(".list-input"),n=$(".active-notes-container");e.val(""),t.val("").focus(),n.empty()}}),RB.Input=Backbone.View.extend({el:".active-list-container",inputTemplate:_.template($("#input-template").html()),initialize:function(){this.render(),console.log("we initing")},events:{"click .create-note-btn":"createNote","keyup .note-input":"createOnEnter","keyup .active-input":"validate","click .garbage-container":"removeAllDone"},render:function(){return $(".active-list-container").html(this.inputTemplate()),this},createOnEnter:function(e){13===e.keyCode&&this.createNote()},validate:function(){var e=$(".note-input").val(),t=$(".list-input").val(),n=$(".create-note-btn .fa");e.trim()&&""!==t.trim()?n.addClass("ready"):n.removeClass("ready")},createNote:function(){var e=$(".note-input"),t=$(".list-input"),n=e.val(),o=t.val();n.trim()&&""!==o.trim()&&RB.post()},removeAllDone:function(){var e=$(".list-input").val(),t=RB.collection.where({list:e,done:!0});console.log(t.length);for(var n=0;n<t.length;n++)RB.destroy(t[n]);var o=RB.collection.where({list:e});console.log(o),o?RB.setListValue(e):($noteInput.val(""),$listInput.val("").focus(),$notesContainer.empty())}}),RB.NoteItem=Backbone.View.extend({className:"list-item",itemTemplate:_.template($("#note-item-template").html()),initalize:function(){this.render()},events:{"click .edit .fa-trash":"destroyNote","click .edit .fa-check-square":"toggleDone"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},destroyNote:function(){RB.destroy(this.model),$(document).trigger("listSelected"),$(document).trigger("listChanged"),this.remove()},toggleDone:function(){var e=this.model,t=e.get("done"),n=this,o=!t,i={done:o};console.log(e),e.save(i,{success:function(e,t){$(document).trigger("listSelected"),$(document).trigger("listChanged"),RB.collection.set(e),n.render({model:e}),console.log(e,t)},error:function(e){console.log(e)}})}}),RB.init();