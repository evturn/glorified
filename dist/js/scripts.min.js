var RB={};RB.Note=Backbone.Model.extend({idAttribute:"_id"}),RB.Notes=Backbone.Collection.extend({model:RB.Note,url:"/notes",merge:!0}),RB.List=Backbone.Collection.extend({model:RB.Note,url:"/notes",merge:!0}),RB.all=function(){var t=new RB.Notes;t.fetch({success:function(t){console.log(t);new RB.App({collection:t});RB.collection=t},error:function(t){console.log(t)}})},RB.reset=function(t){var e=RB.collection;e.fetch({success:function(e){var n=RB.getLists(e),i=e.where({list:t}),o=RB.getNotes(i);RB.setLists(e,n),RB.setNotes(".active-notes-container",o)},error:function(t){console.log(t)}})},RB.returnVal=function(t){return t},RB.getLists=function(t){var e=[];return t.each(function(t){var n=t.get("list");-1===e.indexOf(n)&&e.push(n)}),e},RB.setLists=function(t,e){var n=e,i=_.template($("#list-name-template").html()),o=$(".lists-container");o.empty();for(var s=0;s<n.length;s++){{var l=t.where({list:n[s]});new RB.Input}o.append(i({name:n[s],length:l.length}))}},RB.setNotes=function(t,e){var n=e[0].get("list");$(".active-input.list-input").val(n),$selector=RB.tojquery(t),$selector.empty();for(var i=0;i<e.length;i++){var o=e[i],s=new RB.NoteItem({model:o});$selector.append(s.render().el)}},RB.notify=function(t){var e=$(".kurt-loader"),n='<i class="fa fa-bell-o"></i>',i='<p class="notification thin-lg animated fadeIn">'+n+" "+t+"</p>";e.html(i),setTimeout(function(){$(".notification").removeClass("animated fadeIn"),$(".notification").addClass("animated fadeOut")},1200)},RB.fixPath=function(){if(window.location.hash&&"#_=_"===window.location.hash){var t={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=t.top,document.body.scrollLeft=t.left}},RB.tojquery=function(t){switch(typeof t){case"object":if(t instanceof jQuery)return t;break;case"string":return $("."===t.charAt(0)?t:document.getElementsByClassName(t))}},RB.convertDate=function(t){var e=new Date(t),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],i=(e.getFullYear(),e.getMonth()),o=e.getDate(),s=e.getHours(),l=e.getMinutes(),a=l>10?l:"0"+l,c=s>=12?"PM":"AM",r=s>12?s-12:s;i=(""+(i+1)).slice(-2);var d=n[e.getDay()]+" "+i+"/"+o+" "+r+":"+a+c;return d},RB.post=function(){var t=Date.now(),e=RB.convertDate(t),n=RB.collection,i={body:$(".note-input").val(),list:$(".list-input").val(),created:t,timestamp:e,done:!1};if(n.findWhere({body:i.body})&&n.findWhere({list:i.list}))return!1;var o=n.create(i);return o},RB.put=function(t){var e=t.get("list"),n=RB.collection;n.set(t),RB.reset(e),RB.notify("Updated")},RB.destroy=function(t){var e=t.get("list");t.destroy({success:function(t){RB.reset(e),RB.notify("Note deleted")},error:function(t){RB.reset(e),RB.notify("Removed")}})},RB.e={init:function(){RB.e.setActiveList(),RB.e.collapseLists(),RB.e.expandLists()},setActiveList:function(){$(document).on("click",".lists-container .list-item",function(){$(".list-item").removeClass("active"),$(this).addClass("active")})},collapseLists:function(){$(document).on("click",".toggle-list-btn.close-list",function(){var t=$(".lists-container"),e=$(".toggle-list-btn.open-list"),n=$(".toggle-list-btn.close-list");n.addClass("hidden"),e.removeClass("hidden"),t.slideToggle("fast")})},expandLists:function(){$(document).on("click",".toggle-list-btn.open-list",function(){var t=$(".lists-container"),e=$(".toggle-list-btn.open-list"),n=$(".toggle-list-btn.close-list");n.removeClass("hidden"),e.addClass("hidden"),t.slideToggle("fast")})}},RB.init=function(){RB.fixPath(),RB.all(),RB.e.init()},RB.App=Backbone.View.extend({el:".dmc",initialize:function(){this.render()},events:{"click .lists-container .list-item":"renderList"},render:function(){var t=RB.getLists(this.collection);RB.setLists(this.collection,t)},renderList:function(t){var e=$(t.currentTarget).data("id"),n=this.collection.where({list:e});RB.setNotes(".active-notes-container",n)}}),RB.Input=Backbone.View.extend({el:".active-list-container",inputTemplate:_.template($("#input-template").html()),initialize:function(){this.render()},events:{"click .create-note-btn":"createNote","keyup .note-input":"createOnEnter","keyup .active-input":"validate","click .create-list-btn":"createList"},render:function(){return $(".active-list-container").html(this.inputTemplate()),this},createOnEnter:function(t){13===t.keyCode&&this.createNote()},validate:function(){var t=$(".note-input").val(),e=$(".list-input").val();t.trim()&&""!==e.trim()?$(".create-note-btn .fa").addClass("ready"):$(".create-note-btn .fa").removeClass("ready")},createNote:function(){var t=$(".note-input").val(),e=$(".list-input").val();t.trim()&&""!==e.trim()&&(RB.post(),RB.reset(e))},createList:function(){var t=$(".active-notes-container");t.empty(),RB.reset("")}}),RB.NoteItem=Backbone.View.extend({className:"list-item",itemTemplate:_.template($("#note-item-template").html()),initalize:function(){this.render()},events:{"click .edit .fa-trash":"destroyNote","click .edit .fa-check-circle":"toggleDone"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},destroyNote:function(){RB.destroy(this.model)},toggleDone:function(){var t=this.model,e=t.get("done");e?(t.set({done:!1}),t.save()):(t.set({done:!0}),t.save()),RB.put(t)}}),RB.init();