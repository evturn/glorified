var RAMENBUFFET={};RAMENBUFFET.Note=Backbone.Model.extend({idAttribute:"_id"}),RAMENBUFFET.Notes=Backbone.Collection.extend({url:"/notes",model:RAMENBUFFET.Note,wait:!0,comparator:"position"}),RAMENBUFFET.ActiveList=Backbone.View.extend({el:".active-list-wrapper",list:null,inputTemplate:_.template($("#active-list-name").html()),initialize:function(t){this.list=t,this.render()},events:{"click .create-note-btn":"createNote","keypress .note-input":"createOnEnter","keyup .active-input":"validate"},render:function(){for(var t,e=0;e<this.list.length;e++)t={name:this.list[e].get("list")};$(".form-list-name").html(this.inputTemplate(t))},createOnEnter:function(t){13===t.keyCode&&this.createNote()},validate:function(t){var e=$(".note-input").val(),i=$(".list-input").val();e.trim()&&""!==i.trim()?$(".create-note-btn .fa").addClass("ready"):$(".create-note-btn .fa").removeClass("ready")},createNote:function(){var t=$(".note-input").val(),e=$(".list-input").val();if(t.trim()&&""===e.trim())return!1;if(notes.findWhere({body:t}))return!1;var i={body:t,list:e};RAMENBUFFET.http.post(i)}}),RAMENBUFFET.ActiveNote=Backbone.View.extend({className:"list-item",itemTemplate:_.template($("#list-active-item").html()),initalize:function(){this.render()},events:{"click .fa-trash":"clear","click .fa-check":"done","click .fa-sort-up":"moveUp","click .fa-sort-down":"moveDown"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},clear:function(){RAMENBUFFET.http.destroy(this.model)},done:function(t){var e=$(t.currentTarget),i=e.parent().parent(),n=this.model;n.get("done")?(n.set({done:!1}),i.removeClass("done")):(n.set({done:!0}),i.addClass("done")),RAMENBUFFET.http.put(n),this.render()},moveUp:function(){var t=this.model,e=t.get("position"),i=t.get("list"),n=notes.where({list:i}),o=n.length;if(1===e)return!1;for(var s,l,a=0;o>a;a++){var s=n[a],l=s.get("position");l===e-1&&(t.set({position:l}),s.set({position:e}))}RAMENBUFFET.http.put(t),RAMENBUFFET.http.put(s)},moveDown:function(){var t=this,e=this.model,i=e.get("position"),n=e.get("list"),o=notes.where({list:n}),s=o.length;if(i===s)return!1;for(var l=0;s>l;l++)if(o[l].get("position")===i+1){var a=o[l];a.set({position:i}),RAMENBUFFET.http.put(t,a)}e.set({position:i+1}),RAMENBUFFET.http.put(t,e)}}),RAMENBUFFET.ListItem=Backbone.View.extend({className:"menu-list list-item",itemTemplate:_.template($("#list-name-item").html()),initalize:function(){this.render()},render:function(t){return this.$el.html(this.itemTemplate(t)),this.$el.attr("data-id",t.name),this}}),RAMENBUFFET.App=Backbone.View.extend({el:".dmc",initialize:function(){RAMENBUFFET.http.get()},events:{"click .create-list-btn":"newList","click .menu-list.list-item":"select"},select:function(t){var e=$(t.currentTarget).data("id");return RAMENBUFFET.fn.selectList(e),this},newList:function(){$(".active-notes-container").empty(),$(".list-input").val(""),$(".list-input").focus();new RAMENBUFFET.ActiveList}}),RAMENBUFFET.e={init:function(){this.fixPath()},notify:function(t){var e=$(".kurt-loader"),i='<i class="fa fa-asterisk"></i>',n='<p class="notification thin-lg animated fadeIn">'+i+" "+t+"</p>";e.html(n);var o=$(".notification");setTimeout(function(){o.removeClass("fadeIn"),o.addClass("fadeOut")},1200)},fixPath:function(){if(window.location.hash&&"#_=_"===window.location.hash){var t={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=t.top,document.body.scrollLeft=t.left}}},RAMENBUFFET.fn={selectList:function(t){return RAMENBUFFET.fn.setActive(t),this},setLists:function(t){var e=$(".lists-container"),i=[];e.empty(),t.each(function(t){var e=t.get("list");-1===i.indexOf(e)&&i.push(e)});for(var n=0;n<i.length;n++){var o=i[n],s=t.where({list:o}).length,l=new RAMENBUFFET.ListItem;l.render({name:o,length:s}),e.append(l.el)}return this},setActive:function(t){for(var e=$(".active-notes-container"),i=notes.where({list:t}),n=(new RAMENBUFFET.ActiveList(i),new RAMENBUFFET.Notes(i)),o=0;o<n.length;o++){n.models[o].set({position:o+1})}e.empty();for(var s=0;s<n.length;s++){var l=new RAMENBUFFET.ActiveNote({model:n.models[s]});l.render(),e.append(l.el)}return this},convertDate:function(t){var e=new Date(t),i=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],n=(e.getFullYear(),e.getMonth()),o=e.getDate(),s=e.getHours(),l=e.getMinutes(),a=l>10?l:"0"+l,r=s>=12?"PM":"AM",c=s>12?s-12:s;n=(""+(n+1)).slice(-2);var d=i[e.getDay()]+" "+n+"/"+o+" "+c+":"+a+r;return d}},RAMENBUFFET.http={get:function(t){notes.fetch({success:function(t){var e="New List";return RAMENBUFFET.fn.setLists(t),RAMENBUFFET.fn.setActive(e),t},error:function(t){return RAMENBUFFET.e.notify(t)}})},post:function(t){var e=t.list,i=Date.now(),n=RAMENBUFFET.fn.convertDate(i),o=notes.where({list:e}).length,s=notes.create({body:t.body,list:e,created:i,timestamp:n,position:o+1}),l=new RAMENBUFFET.ActiveNote({model:s});l.render(),$(".active-notes-container").append(l.el),RAMENBUFFET.fn.setLists(notes),RAMENBUFFET.e.notify("Note added")},put:function(t){var e=t,i=t.get("list");console.log(e),$.ajax({type:"PUT",url:"notes/"+e.get("_id"),data:e.toJSON(),dataType:"JSON",success:function(t){RAMENBUFFET.e.notify("Note updated"),console.log("Ajaxing ",t),RAMENBUFFET.fn.setActive(i)},error:function(t){RAMENBUFFET.e.notify(t)}})},destroy:function(t){t.destroy({success:function(t,e){notes.remove(t),RAMENBUFFET.e.notify("Note deleted"),console.log(e)},error:function(t){RAMENBUFFET.e.notify(t),console.log(t)}})}},RAMENBUFFET.lists={init:function(){this.setActiveList(),this.collapseLists(),this.expandLists()},setActiveList:function(){$(document).on("click",".lists-container .list-item",function(){$(".list-item").removeClass("active"),$(this).addClass("active")})},collapseLists:function(){$(document).on("click",".toggle-list-btn.close-list",function(){var t=$(".lists-container"),e=$(".toggle-list-btn.open-list"),i=$(".toggle-list-btn.close-list");i.addClass("hidden"),e.removeClass("hidden"),t.slideToggle("fast")})},expandLists:function(){$(document).on("click",".toggle-list-btn.open-list",function(){var t=$(".lists-container"),e=$(".toggle-list-btn.open-list"),i=$(".toggle-list-btn.close-list");i.removeClass("hidden"),e.addClass("hidden"),t.slideToggle("fast")})}};var notes=new RAMENBUFFET.Notes,wrapper=new RAMENBUFFET.App({collection:notes});RAMENBUFFET.init=function(){RAMENBUFFET.lists.init(),RAMENBUFFET.e.init(),(new WOW).init()},$(document).ready(function(){RAMENBUFFET.init()});