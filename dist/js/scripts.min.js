var Note=Backbone.Model.extend({idAttribute:"_id"}),User=Backbone.Model.extend({}),Notes=Backbone.Collection.extend({url:"/notes",model:Note}),ActiveList=Backbone.View.extend({el:".active-list-wrapper",list:null,inputTemplate:_.template($("#active-list-name").html()),initialize:function(t){this.list=t,this.render()},events:{"click .create-note-btn":"createNote","keypress .note-input":"createOnEnter","keyup .active-input":"elluminateBtn"},render:function(){for(var t,e=0;e<this.list.length;e++)t={name:this.list[e].get("list")};$(".form-list-name").html(this.inputTemplate(t))},createOnEnter:function(t){13===t.keyCode&&this.createNote()},elluminateBtn:function(t){var e=$(".note-input").val(),n=$(".list-input").val();e.trim()&&""!==n.trim()?$(".create-note-btn .fa").addClass("ready"):$(".create-note-btn .fa").removeClass("ready")},createNote:function(){var t=$(".note-input").val(),e=$(".list-input").val();if(""===t||""===e)return!1;var n=Date.now(),i=this.convertDate(n);return wrapper.collection.findWhere({body:t})?!1:void wrapper.collection.create({body:t,list:e,created:n,timestamp:i},{success:function(t){var e=new NoteItem({model:t});e.render(),$(".active-notes-container").append(e.el);var n="Note added";RAMENBUFFET.e.notify(n),$(".note-input").val("")},error:function(t){var e="Error creating note";RAMENBUFFET.e.notify(e)}})},convertDate:function(t){var e=new Date(t),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],i=(e.getFullYear(),e.getMonth()),o=e.getDate(),s=e.getHours(),l=e.getMinutes(),a=s>12?"PM":"AM",r=s>12?s-12:s;i=(""+(i+1)).slice(-2);var c=n[e.getDay()]+" "+i+"/"+o+" "+r+":"+l+a;return c}}),NoteItem=Backbone.View.extend({className:"list-item wow fadeIn animated",itemTemplate:_.template($("#list-active-item").html()),initalize:function(){this.render()},events:{"click .fa-trash":"clear","click .fa-check":"put"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},clear:function(){var t=this,e=this.model;$.ajax({type:"DELETE",url:"notes/"+this.model.get("_id"),data:e.toJSON(),success:function(n){wrapper.collection.remove(e.get("_id")),t.remove();var i="Note deleted";RAMENBUFFET.e.notify(i)},error:function(e){t.remove();var n="Error deleting note";RAMENBUFFET.e.notify(n)}})},put:function(t){var e=$(t.currentTarget),n=this.model;$.ajax({type:"PUT",url:"notes/"+n.get("_id"),data:n.toJSON(),dataType:"JSON",success:function(t){var e="Note updated";RAMENBUFFET.e.notify(e)},error:function(t){var e="Error updating note";RAMENBUFFET.e.notify(e)}}),this.model.get("done")?(e.parent().parent().removeClass("done"),n.set({done:!1})):(e.parent().parent().addClass("done"),n.set({done:!0})),this.render()}}),MenuItem=Backbone.View.extend({className:"menu-list list-item animated",itemTemplate:_.template($("#list-name-item").html()),initalize:function(){this.render()},render:function(t){return this.$el.html(this.itemTemplate(t)),this.$el.attr("data-id",t.name),this}}),Wrapper=Backbone.View.extend({el:".dmc",initialize:function(){var t=this;this.collection=new Notes,this.collection.fetch({success:function(e){return console.log("fetch ",e),t.setLists(),t.setActive(),e},error:function(t){$(".active-notes").prepend('<p class="lead">'+t+"</p>")}}),this.listenTo(this.collection,"all",this.setLists)},events:{"click .create-list-btn":"newList","click .menu-list.list-item":"select"},select:function(t){console.log(t);var e=$(t.currentTarget).data("id");return this.setActive(e),this},setLists:function(){$(".lists-container").empty();var t=this,e=[];this.collection.each(function(t){var n=t.get("list");-1===e.indexOf(n)&&e.push(n)});for(var n=0;n<e.length;n++){var i=e[n],o=t.collection.where({list:e[n]}).length,s=new MenuItem;s.render({name:i,length:o}),$(".lists-container").append(s.el)}return this},setActive:function(t){$(".active-notes-container").empty();for(var e=this.collection.where({list:t}),n=(new ActiveList(e),0);n<e.length;n++){var i=new NoteItem({model:e[n]});i.render(),$(".active-notes-container").append(i.el)}return this},newList:function(){$(".active-notes-container").empty(),$(".list-input").val(""),$(".list-input").focus();new ActiveList}});(new WOW).init();var wrapper=new Wrapper,RAMENBUFFET={init:function(){RAMENBUFFET.lists.init()}};RAMENBUFFET.lists={init:function(){this.setActiveList(),this.collapseLists(),this.expandLists()},setActiveList:function(){$(document).on("click",".lists-container .list-item",function(){$(".list-item").removeClass("active"),$(this).addClass("active")})},collapseLists:function(){$(document).on("click",".toggle-list-btn.close-list",function(){var t=$(".lists-container .list-item"),e=$(".toggle-list-btn.open-list"),n=$(".toggle-list-btn.close-list");n.addClass("hidden"),e.removeClass("hidden"),t.slideToggle("fast")})},expandLists:function(){$(document).on("click",".toggle-list-btn.open-list",function(){var t=$(".lists-container .list-item"),e=$(".toggle-list-btn.open-list"),n=$(".toggle-list-btn.close-list");n.removeClass("hidden"),e.addClass("hidden"),t.slideToggle("fast")})}},$(document).ready(function(){RAMENBUFFET.init()}),RAMENBUFFET.e={notify:function(t){$(".kurt-loader").html('<p class="notification thin-lg animated bounceIn">'+t+"</p>"),$(".notification").fadeOut("slow",function(){$(".kurt-loader").empty()})}},$(function(){if($('[data-toggle="popover"]').popover({html:!0}),window.location.hash&&"#_=_"===window.location.hash){var t={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=t.top,document.body.scrollLeft=t.left}});