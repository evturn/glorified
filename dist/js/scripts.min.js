var ListName=Backbone.Model.extend({}),Note=Backbone.Model.extend({}),User=Backbone.Model.extend({}),Notes=Backbone.Collection.extend({url:"/notes",model:Note,initialize:function(){this.fetch({success:function(e){console.log("fetch ",e);new MenuLists({collection:e});return e},error:function(e){$(".active-notes").prepend('<p class="lead">'+e+"</p>")}})},lists:function(e){for(var t=e||this,n=[],i=0;i<t.models.length;i++){var o=t.models[i].attributes.list;-1===n.indexOf(o)&&n.push(o)}return n},firstList:function(){var e=this.lists();console.log(e[0])},newestList:function(){var e=this.lists();console.log(e[length-1])}}),notes=new Notes,ActiveList=Backbone.View.extend({el:".active-list-container",inputTemplate:_.template($("#active-input").html()),list:null,initialize:function(e){e?this.switchList(e.name):this.render()},events:{"click .create-note-btn":"createNote","keypress .note-input":"createOnEnter","keyup .active-input":"elluminateBtn"},render:function(){this.collection.each(function(e){var t=new NoteItem({model:e});t.render(),$(".active-notes").append(t.el)})},switchList:function(e){$(".active-notes").empty();var t=this,n={name:e};$(".active-list").html(this.inputTemplate(n)),this.collection.each(function(n){if(n.get("list")===e){var i=t.convertDate(new Date(n.get("created"))),o=n.set({timestamp:i}),l=new NoteItem({model:o});l.render(),$(".active-notes").append(l.el)}})},createOnEnter:function(e){13===e.keyCode&&this.createNote()},elluminateBtn:function(e){var t=$(".note-input").val(),n=$(".list-input").val();t.trim()&&""!==n.trim()?$(".create-note-btn .fa").addClass("ready"):$(".create-note-btn .fa").removeClass("ready")},createNote:function(){$(".kurt-loader").html('<img src="img/dog.gif">');var e=$(".note-input").val(),t=$(".list-input").val();if(""===e||""===t)return!1;var n=notes.create({body:e,list:t}),i=new NoteItem({model:n});i.render(),$(".active-notes").append(i.el),$(".kurt-loader").fadeOut("fast",function(){$(".kurt-loader").empty()}),$(".note-input").val("")},convertDate:function(e){var t=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],n=e,i=(n.getFullYear(),n.getMonth()),o=n.getDate(),l=n.getHours(),s=n.getMinutes(),a=l>12?"PM":"AM",c=l>12?l-12:l;i=(""+(i+1)).slice(-2);var r=t[n.getDay()]+" "+i+"/"+o+" "+c+":"+s+a;return r}}),NoteItem=Backbone.View.extend({itemTemplate:_.template($("#list-active-item").html()),initalize:function(){this.render()},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this}}),MenuItem=Backbone.View.extend({itemTemplate:_.template($("#list-name-item").html()),initalize:function(){this.render()},events:{"click .list-item":"select"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},select:function(){{var e=this.model.get("name");new ActiveList({collection:notes,name:e})}}}),MenuLists=Backbone.View.extend({el:".list-container",initialize:function(){this.render()},render:function(){var e=this,t=[];this.collection.each(function(n){var i=n.get("list");if(-1===t.indexOf(i)){t.push(i);var o=e.collection.where({list:i}).length,l=new ListName({name:i,length:o}),s=new MenuItem({model:l});s.render(),$(".list-names-container").append(s.el)}});new ActiveList({collection:this.collection})}});$(document).on("click",".list-names-container .list-item",function(){$(".list-item").removeClass("active"),$(this).addClass("active")});