var ListName=Backbone.Model.extend({}),Note=Backbone.Model.extend({idAttribute:"_id"}),User=Backbone.Model.extend({}),Notes=Backbone.Collection.extend({url:"/notes",model:Note}),ActiveList=Backbone.View.extend({el:".active-list-container",inputTemplate:_.template($("#active-input").html()),list:null,initialize:function(e){if(e)this.switchList(e.name);else{var t=this.collection.models[length-1].get("list");this.switchList(t)}},events:{"click .create-note-btn":"createNote","keypress .note-input":"createOnEnter","keyup .active-input":"elluminateBtn"},switchList:function(e){$(".active-notes").empty();var t=this,n={name:e};$(".active-list").html(this.inputTemplate(n)),this.collection.each(function(n){if(n.get("list")===e){var i=t.convertDate(new Date(n.get("created"))),o=n.set({timestamp:i}),a=new NoteItem({model:o});a.render(),$(".active-notes").append(a.el)}})},createOnEnter:function(e){13===e.keyCode&&this.createNote()},elluminateBtn:function(e){var t=$(".note-input").val(),n=$(".list-input").val();t.trim()&&""!==n.trim()?$(".create-note-btn .fa").addClass("ready"):$(".create-note-btn .fa").removeClass("ready")},createNote:function(){var e=this,t=$(".note-input").val(),n=$(".list-input").val();if(""===t||""===n)return!1;var i;i=notes.create({body:t,list:n},{success:function(){var t=e.convertDate(new Date(i.get("created"))),n=i.set({timestamp:t}),o=new NoteItem({model:n});o.render(),$(".active-notes").append(o.el),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">New note created</p>'),$(".note-input").val("")}}),notify()},convertDate:function(e){var t=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],n=e,i=(n.getFullYear(),n.getMonth()),o=n.getDate(),a=n.getHours(),l=n.getMinutes(),s=a>12?"PM":"AM",c=a>12?a-12:a;i=(""+(i+1)).slice(-2);var r=t[n.getDay()]+" "+i+"/"+o+" "+c+":"+l+s;return r}}),NoteItem=Backbone.View.extend({itemTemplate:_.template($("#list-active-item").html()),initalize:function(){this.render()},events:{"click .fa-trash":"clear","click .fa-check":"done"},render:function(){return this.$el.html(this.itemTemplate(this.model.toJSON())),this},clear:function(){var e=this;$.ajax({type:"DELETE",url:"notes/"+this.model.get("_id"),success:function(t){e.remove(),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">'+t+"</p>"),notify()},error:function(e){$(".kurt-loader").html('<p class="thin-lg wow bounceIn">'+e+"</p>"),notify()}})},done:function(e){var t=$(e.currentTarget),n=this.model;this.model.get("done")?(t.parent().parent().removeClass("done"),n.set({done:!1})):(t.parent().parent().addClass("done"),n.set({done:!0})),$.ajax({type:"PUT",url:"notes/"+n.get("_id"),data:n.toJSON(),dataType:"JSON",success:function(e){console.log(e),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">Note updated</p>'),notify()},error:function(e){console.log(e),$(".kurt-loader").html('<p class="thin-lg wow bounceIn">Note updated</p>'),notify()}}),this.render()}}),MenuItem=Backbone.View.extend({itemTemplate:_.template($("#list-name-item").html()),initalize:function(){this.render()},events:{"click .list-item":"select"},render:function(e){return $(".list-names-container").append(this.itemTemplate(e)),this},select:function(){{var e=this.model.get("name");new ActiveList({collection:notes,name:e})}}}),MenuLists=Backbone.View.extend({el:".list-container",initialize:function(){this.render()},render:function(){var e=new MenuItem({model:listName});e.render(),$(".list-names-container").append(e.el);new ActiveList({collection:this.collection})}}),Wrapper=Backbone.View.extend({el:".app-wrapper",initialize:function(){var e=this;this.collection=new Notes,this.collection.fetch({success:function(t){return console.log("fetch ",t),e.lists(),t},error:function(e){$(".active-notes").prepend('<p class="lead">'+e+"</p>")}})},lists:function(){var e=this,t=[];return this.collection.each(function(n){var i=n.get("list");if(-1===t.indexOf(i)){var o=e.collection.where({list:i}).length,a=new MenuItem;a.render({name:i,length:o}),t.push(i)}}),this},menu:function(e){for(var t=(self.collection.where({list:listName}),0);t<e.length;t++)console.log(e[t].name),console.log(e[t].models)}});(new WOW).init();var wrapper=new Wrapper;$(document).on("click",".list-names-container .list-item",function(){$(".list-item").removeClass("active"),$(this).addClass("active")});var notify=function(){setTimeout(function(){$(".kurt-loader").fadeOut("fast",function(){$(".kurt-loader").empty(),$(".kurt-loader").css({display:"block"})})},3e3)};