"use strict";var RB={};RB.User=Backbone.Model.extend({url:"/users",idAttribute:"_id"}),RB.Note=Backbone.Model.extend({idAttribute:"_id"}),RB.List=Backbone.Model.extend({idAttribute:"_id"}),RB.Lists=Backbone.Collection.extend({model:RB.List,url:"/notes"}),RB.Notes=Backbone.Collection.extend({model:RB.Note,url:"/notes",merge:!0}),_.extend(Backbone.View.prototype,{start:function(){var t=new RB.User;t.fetch({success:function(t,e){if(null===app.user&&(app.user=t),null===app.listsCollection){app.listsCollection=new RB.Lists(t.attributes.lists);var n=app.getListNames(app.listsCollection);app.setLists(n)}return console.log(app.listsCollection),app.listsCollection},error:function(t){console.log(t)}})},post:function(t){var e=$(".note-input"),n=$(".active-notes-container");$.ajax({url:"/notes/",method:"POST",data:t,success:function(t,i){console.log(t),e.val("").focus(),app.validate();var o=new RB.Note(t),s=new RB.NoteItem({model:o});n.append(s.render().el),s.notify("Created")},error:function(t){console.log(t)}})},put:function(t,e,n){{var i=this,o=t.get("_id");t.get("list")}t.save(e,{url:"/notes/"+o,success:function(t,e){i.notify("Updated"),i.onChangeListeners(),n.render()},error:function(t){console.log(t)}})},destroy:function(t){var e=this,n=(t.get("list"),t.get("_id"));null!==n&&t.destroy({wait:!0,url:"/notes/"+n,dataType:"text",data:{_id:n},success:function(t){console.log("success ",t),e.notify("Removed"),e.onChangeListeners()},error:function(t){console.log("error ",t)}})}}),_.extend(Backbone.View.prototype,{garbageTemplate:_.template($("#garbage-watcher-template").html()),allDoneTemplate:_.template($("#sunny-template").html()),getNotesByListname:function(t){var e=app.listsCollection.where({name:t});return e},getListNames:function(){var t=[];return app.listsCollection.each(function(e){t.push(e.get("name"))}),t},setLists:function(){var t=$(".lists-container");t.empty(),app.listsCollection.each(function(e){var n=new RB.ListItem({model:e});t.append(n.render().el)})},setNote:function(t){var e=$(".active-notes-container"),n=new RB.NoteItem({model:t});e.append(n.render().el)},setNotes:function(t){{var e=app.listsCollection.get(t),n=new RB.Notes(e.attributes.notes),i=e.attributes.name,o=$(".active-notes-container"),s=$(".active-input.list-input");$(".active-input.note-input")}o.empty(),s.val(i),n.each(function(e){var n=new RB.NoteItem({model:e});o.append(n.render().el),o.attr("data-list",t)}),app.notesCollection=n,this.resetActiveList(i),console.log(app.notesCollection)},setListValue:function(t){var e=$(".active-input.list-input");e.val(t)},resetActiveList:function(t){var e=$(".list-item"),n=$("div").find("[data-id='"+t+"']");return e.removeClass("active"),n.addClass("active"),n},getListnameContainer:function(t){var e=$("div").find("[data-id='"+t+"']");return e}}),_.extend(Backbone.View.prototype,{notify:function(t){var e=$(".kurt-loader");e.html('<p class="thin-sm animated fadeIn">'+t+"</p>");var n=e.find(".thin-sm");setTimeout(function(){n.removeClass("animated fadeIn"),n.addClass("animated fadeOut")},1e3)},tojquery:function(t){switch(typeof t){case"object":if(t instanceof jQuery)return t;break;case"string":return $("."===t.charAt(0)?t:document.getElementsByClassName(t))}},convertDate:function(t){var e=new Date(t),n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],i=(e.getFullYear(),e.getMonth()),o=e.getDate(),s=e.getHours(),a=e.getMinutes(),r=a>10?a:"0"+a,l=s>=12?"PM":"AM",c=s>12?s-12:s;i=(""+(i+1)).slice(-2);var u=n[e.getDay()]+" "+i+"/"+o+" "+c+":"+r+l;return u},deviceEnv:function(t){this.isMobile()&&setTimeout(this.toggleLists,t)},isListSelected:function(){var t=$(".active-notes-container .list-item");if(t.length){var e=this.getCurrentList();return this.resetActiveList(e),!0}return!1},setFirstChildActive:function(){var t=$(".lists-container").first();t.addClass("active")},setActiveList:function(){$(document).on("click",".lists-container .list-item",function(){var t=$(".list-item");t.removeClass("active"),$(this).addClass("active"),$(document).trigger("listSelected")})},toggleLists:function(){var t=$(".lists-container"),e=$(".toggle-list-btn .fa");t.slideToggle("fast"),e.toggleClass("collapsed")},isMobile:function(){var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return t},sunny:function(){var t=0;setInterval(function(){$(".fa.fa-certificate").css({"-ms-transform":"rotate("+t+"deg)"}).css({"-moz-transform":"rotate("+t+"deg)"}).css({"-o-transform":"rotate("+t+"deg)"}).css({"-webkit-transform":"rotate("+t+"deg)"}).css({transform:"rotate("+t+"deg)"}),t+=3},100)},fixPath:function(){if(window.location.hash&&"#_=_"===window.location.hash){var t={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=t.top,document.body.scrollLeft=t.left}}}),RB.App=Backbone.View.extend({el:".dmc",inputTemplate:_.template($("#input-template").html()),user:null,listsCollection:null,notesCollection:null,initialize:function(){this.fixPath(),this.setActiveList(),this.deviceEnv(800),this.sunny(),this.isListSelected(),this.renderInputFields()},events:{"click .create-list-btn":"createList","click .toggle-list-btn":"toggleLists","click .create-note-btn":"createNote","keyup .note-input":"createOnEnter","keyup .active-input":"validate"},createList:function(){var t=$(".note-input"),e=$(".list-input"),n=$(".active-notes-container");t.val(""),e.val("").focus(),n.empty(),this.onChangeListeners()},renderInputFields:function(){return $(".active-list-container").html(this.inputTemplate()),this},createOnEnter:function(t){13===t.keyCode&&this.createNote()},validate:function(){var t=$(".note-input").val(),e=$(".list-input").val(),n=$(".create-note-btn .fa");t.trim()&&""!==e.trim()?n.addClass("ready"):n.removeClass("ready")},createNote:function(){var t=$(".note-input").val(),e=$(".list-input").val();if(t.trim()&&""!==e.trim()){var n={body:t,list:e,done:!1};if(app.listsCollection.models>0){var i=app.listsCollection.findWhere({name:e});console.log(i);for(var o=0;o<i.attributes.notes.length;o++){var s=i.attributes.notes[o].body;if(n.body===s)return!1}}this.post(n)}}}),RB.ListItem=Backbone.View.extend({className:"list-item",listTemplate:_.template($("#list-name-template").html()),events:{"click .inner-container":"selected"},initialize:function(){this.render()},render:function(){return this.$el.html(this.listTemplate(this.model.toJSON())),this},selected:function(t){var e=$(t.currentTarget).data("id");console.log(e),this.setNotes(e),this.deviceEnv(400)}}),RB.NoteItem=Backbone.View.extend({className:"list-item",itemTemplate:_.template($("#note-item-template").html()),attributes:{},initalize:function(){this.listenTo(this.model,"destroy",this.remove)},events:{"click .edit .fa-trash":"destroyNote","click .edit .fa-check-square":"toggleDone","click .note-text":"positionCursor","blur .note-text":"updateNoteBody","keyup .note-text":"updateNoteOnEnter"},render:function(){return this.model.get("timestamp")||this.model.set("timestamp",this.convertDate(Date.now())),this.model.get("done")||this.model.set("done",!1),this.$el.html(this.itemTemplate(this.model.toJSON())),this},positionCursor:function(t){var e=$(t.currentTarget),n=e.val().length;return e.hasClass("busy")?!1:(e.addClass("busy"),void e[0].setSelectionRange(n,n+1))},destroyNote:function(){this.destroy(this.model),this.remove()},toggleDone:function(){var t=this.model.get("done"),e={done:!t};this.put(this.model,e,this)},updateNoteBody:function(t){var e=$(t.currentTarget),n=e.val().trim(),i={body:n};e.removeClass("busy"),this.put(this.model,i,this)},updateNoteOnEnter:function(t){var e=$(t.currentTarget);13===t.keyCode&&e.blur()}});var app=new RB.App;app.start();